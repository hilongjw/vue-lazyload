/*!
 * Vue-Lazyload.js v1.3.4
 * (c) 2021 Awe <hilongjw@gmail.com>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload={})}(this,(function(t){"use strict";function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=e((function(t){const e=Object.prototype.toString,i=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols;t.exports=(t,...s)=>{if("function"!=typeof(n=t)&&"[object Object]"!==e.call(n)&&!Array.isArray(n))throw new TypeError("expected the first argument to be an object");var n;if(0===s.length||"function"!=typeof Symbol||"function"!=typeof r)return t;for(let e of s){let s=r(e);for(let r of s)i.call(e,r)&&(t[r]=e[r])}return t}})),r=Object.freeze({__proto__:null,default:i,__moduleExports:i}),s=r&&i||r,n=e((function(t){const e=Object.prototype.toString,i=t=>"__proto__"!==t&&"constructor"!==t&&"prototype"!==t,r=t.exports=(t,...e)=>{let o=0;var a;for(("object"==typeof(a=t)?null===a:"function"!=typeof a)&&(t=e[o++]),t||(t={});o<e.length;o++)if(n(e[o])){for(const s of Object.keys(e[o]))i(s)&&(n(t[s])&&n(e[o][s])?r(t[s],e[o][s]):t[s]=e[o][s]);s(t,e[o])}return t};function n(t){return"function"==typeof t||"[object Object]"===e.call(t)}}));const o="undefined"!=typeof window&&null!==window,a=function(){if(o&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}),!0;return!1}();const l="event",d="observer",h=function(){if(o)return"function"==typeof window.CustomEvent?window.CustomEvent:(t.prototype=window.Event.prototype,t);function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}}();function c(t,e){if(!t.length)return;const i=t.indexOf(e);return i>-1?t.splice(i,1):void 0}function u(t,e){let i={src:"",baseValue:0,descriptor:null};if("IMG"!==t.tagName||!t.getAttribute("data-srcset"))return i;let r=t.getAttribute("data-srcset");const s=[],n=t.parentNode.offsetWidth*e;let o,a,l;r=r.trim().split(",");const d=((r[r.length-1]||"").trim().split(" ")[1]||"").substr(-1),h="x"===d;let c;i.descriptor=d,r.map((t=>{t=t.trim(),o=t.lastIndexOf(" "),-1===o?(a=t,l=h?1:999998):(a=t.substr(0,o),l=parseInt(t.substr(o+1,t.length-o-2),10)),s.push([l,a])})),s.sort((function(t,e){if(t[0]<e[0])return 1;if(t[0]>e[0])return-1;if(t[0]===e[0]){if(-1!==e[1].indexOf(".webp",e[1].length-5))return 1;if(-1!==t[1].indexOf(".webp",t[1].length-5))return-1}return 0}));let u=h?e:n;for(let t=0;t<s.length;t++){c=s[t],i.baseValue=c[0],i.src=c[1];const e=s[t+1];if(e&&e[0]<u){i.baseValue=c[0],i.src=c[1];break}if(!e){i.baseValue=c[0],i.src=c[1];break}}return i}function p(t,e){let i;for(let r=0,s=t.length;r<s;r++)if(e(t[r])){i=t[r];break}return i}const f=(t=1)=>o&&window.devicePixelRatio||t;function g(){if(!o)return!1;let t=!0;try{const e=document.createElement("canvas");e.getContext&&e.getContext("2d")&&(t=0===e.toDataURL("image/webp").indexOf("data:image/webp"))}catch(e){t=!1}return t}const b=function(){if(!o)return;let t=!1;try{let e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}(),m={on(t,e,i,r=!1){b?t.addEventListener(e,i,{capture:r,passive:!0}):t.addEventListener(e,i,r)},off(t,e,i,r=!1){t.removeEventListener(e,i,r)}},v=(t,e,i)=>{let r=new Image;if(!t||!t.src){const t=new Error("image src is required");return i(t)}r.src=t.src,t.cors&&(r.crossOrigin=t.cors),r.onload=function(){e({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:r.src})},r.onerror=function(t){i(t)}},y=(t,e)=>"undefined"!=typeof getComputedStyle?getComputedStyle(t,null).getPropertyValue(e):t.style[e],w=t=>y(t,"overflow")+y(t,"overflow-y")+y(t,"overflow-x");function L(){}class _{constructor({max:t}){this.options={max:t||100},this._caches=[]}has(t){return this._caches.indexOf(t)>-1}add(t){this.has(t)||(this._caches.push(t),this._caches.length>this.options.max&&this.free())}free(){this._caches.shift()}}class z{constructor({el:t,src:e,error:i,loading:r,baseValue:s,descriptor:n,bindType:o,$parent:a,options:l,cors:d,elRenderer:h,imageCache:c}){this.el=t,this.src=e,this.error=i,this.loading=r,this.baseValue=s,this.descriptor=n,this.bindType=o,this.attempt=0,this.cors=d,this.naturalHeight=0,this.naturalWidth=0,this.options=l,this.rect=null,this.$parent=a,this.elRenderer=h,this._imageCache=c,this.performanceData={init:Date.now(),loadStart:0,loadEnd:0},this.filter(),this.initState(),this.render("loading",!1)}initState(){"dataset"in this.el?this.el.dataset.src=this.src:this.el.setAttribute("data-src",this.src),this.state={loading:!1,error:!1,loaded:!1,rendered:!1}}record(t){this.performanceData[t]=Date.now()}update({src:t,loading:e,error:i,baseValue:r,descriptor:s}){const n=this.src;this.src=t,this.loading=e,this.error=i,this.baseValue=r,this.descriptor=s,this.filter(),n!==this.src&&(this.attempt=0,this.initState())}getRect(){this.rect=this.el.getBoundingClientRect()}checkInView(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}filter(){(function(t){if(!(t instanceof Object))return[];if(Object.keys)return Object.keys(t);{let e=[];for(let i in t)t.hasOwnProperty(i)&&e.push(i);return e}})(this.options.filter).map((t=>{this.options.filter[t](this,this.options)}))}renderLoading(t){this.state.loading=!0,v({src:this.loading,cors:this.cors},(e=>{this.render("loading",!1),this.state.loading=!1,t()}),(()=>{t(),this.state.loading=!1,this.options.silent||console.warn(`VueLazyload log: load failed with loading image(${this.loading})`)}))}load(t=L){return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log(`VueLazyload log: ${this.src} tried too more than ${this.options.attempt} times`),void t()):this.state.rendered&&this.state.loaded?void 0:this._imageCache.has(this.src)?(this.state.loaded=!0,this.render("loaded",!0),this.state.rendered=!0,t()):void this.renderLoading((()=>{this.attempt++,this.options.adapter.beforeLoad&&this.options.adapter.beforeLoad(this,this.options),this.record("loadStart"),v({src:this.src,cors:this.cors},(e=>{this.naturalHeight=e.naturalHeight,this.naturalWidth=e.naturalWidth,this.state.loaded=!0,this.state.error=!1,this.record("loadEnd"),this.render("loaded",!1),this.state.rendered=!0,this._imageCache.add(this.src),t()}),(t=>{!this.options.silent&&console.error(t),this.state.error=!0,this.state.loaded=!1,this.render("error",!1)}))}))}render(t,e){this.elRenderer(this,t,e)}performance(){let t="loading",e=0;return this.state.loaded&&(t="loaded",e=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(t="error"),{src:this.src,state:t,time:e}}$destroy(){this.el=null,this.src=null,this.error=null,this.loading=null,this.baseValue=null,this.descriptor=null,this.bindType=null,this.attempt=0}}const E="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",x=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],A={rootMargin:"0px",threshold:0};function $(t){return class{constructor({preLoad:t,error:e,throttleWait:i,preLoadTop:r,dispatchEvent:s,loading:n,attempt:o,silent:a=!0,scale:h,listenEvents:c,hasbind:u,filter:p,adapter:b,observer:m,observerOptions:v}){this.version='"1.3.4"',this.mode=l,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:a,dispatchEvent:!!s,throttleWait:i||200,preLoad:t||1.3,preLoadTop:r||0,error:e||E,loading:n||E,attempt:o||3,scale:h||f(h),ListenEvents:c||x,hasbind:!1,supportWebp:g(),filter:p||{},adapter:b||{},observer:!!m,observerOptions:v||A},this._initEvent(),this._imageCache=new _({max:200}),this.lazyLoadHandler=function(t,e){let i=null,r=null,s=0,n=!1;return function(){if(n=!0,i)return;let o=Date.now()-s,a=this,l=arguments,d=function(){s=Date.now(),i=!1,t.apply(a,l)};o>=e?d():i=setTimeout(d,e),n&&(clearTimeout(r),r=setTimeout(d,2*e))}}(this._lazyLoadHandler.bind(this),this.options.throttleWait),this.setMode(this.options.observer?d:l)}config(t={}){n(this.options,t)}performance(){let t=[];return this.ListenerQueue.map((e=>{t.push(e.performance())})),t}addLazyBox(t){this.ListenerQueue.push(t),o&&(this._addListenerTarget(window),this._observer&&this._observer.observe(t.el),t.$el&&t.$el.parentNode&&this._addListenerTarget(t.$el.parentNode))}add(e,i,r){if(function(t,e){let i=!1;for(let r=0,s=t.length;r<s;r++)if(e(t[r])){i=!0;break}return i}(this.ListenerQueue,(t=>t.el===e)))return this.update(e,i),t.nextTick(this.lazyLoadHandler);let{src:s,loading:n,error:a,cors:l}=this._valueFormatter(i.value);t.nextTick((()=>{const{src:d,baseValue:h,descriptor:c}=u(e,this.options.scale);s=d||s,this._observer&&this._observer.observe(e);const p=Object.keys(i.modifiers)[0];let f;p&&(f=r.context.$refs[p],f=f?f.$el||f:document.getElementById(p)),f||(f=(t=>{if(!o)return;if(!(t instanceof HTMLElement))return window;let e=t;for(;e&&e!==document.body&&e!==document.documentElement&&e.parentNode;){if(/(scroll|auto)/.test(w(e)))return e;e=e.parentNode}return window})(e));const g=new z({bindType:i.arg,$parent:f,el:e,loading:n,error:a,src:s,cors:l,baseValue:h,descriptor:c,elRenderer:this._elRenderer.bind(this),options:this.options,imageCache:this._imageCache});this.ListenerQueue.push(g),o&&(this._addListenerTarget(window),this._addListenerTarget(f)),this.lazyLoadHandler(),t.nextTick((()=>this.lazyLoadHandler()))}))}update(e,i,r){let{src:s,loading:n,error:o}=this._valueFormatter(i.value);const{src:a,baseValue:l,descriptor:d}=u(e,this.options.scale);s=a||s;const h=p(this.ListenerQueue,(t=>t.el===e));h?h.update({src:s,loading:n,error:o,baseValue:l,descriptor:d}):this.add(e,i,r),this._observer&&(this._observer.unobserve(e),this._observer.observe(e)),this.lazyLoadHandler(),t.nextTick((()=>this.lazyLoadHandler()))}remove(t){if(!t)return;this._observer&&this._observer.unobserve(t);const e=p(this.ListenerQueue,(e=>e.el===t));e&&(this._removeListenerTarget(e.$parent),this._removeListenerTarget(window),c(this.ListenerQueue,e),e.$destroy())}removeComponent(t){t&&(c(this.ListenerQueue,t),this._observer&&this._observer.unobserve(t.el),t.$parent&&t.$el.parentNode&&this._removeListenerTarget(t.$el.parentNode),this._removeListenerTarget(window))}setMode(t){a||t!==d||(t=l),this.mode=t,t===l?(this._observer&&(this.ListenerQueue.forEach((t=>{this._observer.unobserve(t.el)})),this._observer=null),this.TargetQueue.forEach((t=>{this._initListen(t.el,!0)}))):(this.TargetQueue.forEach((t=>{this._initListen(t.el,!1)})),this._initIntersectionObserver())}_addListenerTarget(t){if(!t)return;let e=p(this.TargetQueue,(e=>e.el===t));return e?e.childrenCount++:(e={el:t,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===l&&this._initListen(e.el,!0),this.TargetQueue.push(e)),this.TargetIndex}_removeListenerTarget(t){this.TargetQueue.forEach(((e,i)=>{e.el===t&&(e.childrenCount--,e.childrenCount||(this._initListen(e.el,!1),this.TargetQueue.splice(i,1),e=null))}))}_initListen(t,e){this.options.ListenEvents.forEach((i=>m[e?"on":"off"](t,i,this.lazyLoadHandler)))}_initEvent(){this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=(t,e)=>{this.Event.listeners[t]||(this.Event.listeners[t]=[]),this.Event.listeners[t].push(e)},this.$once=(t,e)=>{const i=this;this.$on(t,(function r(){i.$off(t,r),e.apply(i,arguments)}))},this.$off=(t,e)=>{if(e)c(this.Event.listeners[t],e);else{if(!this.Event.listeners[t])return;this.Event.listeners[t].length=0}},this.$emit=(t,e,i)=>{this.Event.listeners[t]&&this.Event.listeners[t].forEach((t=>t(e,i)))}}_lazyLoadHandler(){const t=[];this.ListenerQueue.forEach(((e,i)=>{e.el&&e.el.parentNode||t.push(e);e.checkInView()&&e.load()})),t.forEach((t=>{c(this.ListenerQueue,t),t.$destroy()}))}_initIntersectionObserver(){a&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach((t=>{this._observer.observe(t.el)})))}_observerHandler(t,e){t.forEach((t=>{t.isIntersecting&&this.ListenerQueue.forEach((e=>{if(e.el===t.target){if(e.state.loaded)return this._observer.unobserve(e.el);e.load()}}))}))}_elRenderer(t,e,i){if(!t.el)return;const{el:r,bindType:s}=t;let n;switch(e){case"loading":n=t.loading;break;case"error":n=t.error;break;default:n=t.src}if(s?r.style[s]='url("'+n+'")':r.getAttribute("src")!==n&&(r.setAttribute("src",n),"x"===t.descriptor&&function(t,e){if(!(t.width||t.height||t.style.height||t.style.width))if(e>1){const i=(1/e).toFixed(8);t.style.transform=`scale(${i})`,t.style.transformOrigin="0 0"}else delete t.style.transform,delete t.style.transformOrigin}(r,t.baseValue)),r.setAttribute("lazy",e),this.$emit(e,t,i),this.options.adapter[e]&&this.options.adapter[e](t,this.options),this.options.dispatchEvent){const i=new h(e,{detail:t});r.dispatchEvent(i)}}_valueFormatter(t){let e=t,i=this.options.loading,r=this.options.error;var s;return null!==(s=t)&&"object"==typeof s&&(t.src||this.options.silent||console.error("Vue Lazyload warning: miss src with "+t),e=t.src,i=t.loading||this.options.loading,r=t.error||this.options.error),{src:e,loading:i,error:r}}}}$.install=(t,e={})=>{const i=new($(t))(e);"2"===t.version.split(".")[0]?t.directive("lazy",{bind:i.add.bind(i),update:i.update.bind(i),componentUpdated:i.lazyLoadHandler.bind(i),unbind:i.remove.bind(i)}):t.directive("lazy",{bind:i.lazyLoadHandler.bind(i),update(t,e){n(this.vm.$refs,this.vm.$els),i.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:t,oldValue:e},{context:this.vm})},unbind(){i.remove(this.el)}})};const O=t=>({props:{tag:{type:String,default:"div"}},render(t){return t(this.tag,null,this.show?this.$slots.default:null)},data:()=>({el:null,state:{loaded:!1},rect:{},show:!1}),mounted(){this.el=this.$el,t.addLazyBox(this),t.lazyLoadHandler()},beforeDestroy(){t.removeComponent(this)},methods:{getRect(){this.rect=this.$el.getBoundingClientRect()},checkInView(){return this.getRect(),o&&this.rect.top<window.innerHeight*t.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*t.options.preLoad&&this.rect.right>0},load(){this.show=!0,this.state.loaded=!0,this.$emit("show",this)},destroy(){return this.$destroy}}});O.install=function(t,e={}){const i=new($(t))(e);t.component("lazy-component",O(i))};class T{constructor({lazy:t}){this.lazy=t,t.lazyContainerMananger=this,this._queue=[]}bind(t,e,i){const r=new C({el:t,binding:e,vnode:i,lazy:this.lazy});this._queue.push(r)}update(t,e,i){const r=p(this._queue,(e=>e.el===t));r&&r.update({el:t,binding:e,vnode:i})}unbind(t,e,i){const r=p(this._queue,(e=>e.el===t));r&&(r.clear(),c(this._queue,r))}}const I={selector:"img"};class C{constructor({el:t,binding:e,vnode:i,lazy:r}){this.el=null,this.vnode=i,this.binding=e,this.options={},this.lazy=r,this._queue=[],this.update({el:t,binding:e})}update({el:t,binding:e}){this.el=t,this.options=n({},I,e.value);this.getImgs().forEach((t=>{this.lazy.add(t,n({},this.binding,{value:{src:"dataset"in t?t.dataset.src:t.getAttribute("data-src"),error:("dataset"in t?t.dataset.error:t.getAttribute("data-error"))||this.options.error,loading:("dataset"in t?t.dataset.loading:t.getAttribute("data-loading"))||this.options.loading}}),this.vnode)}))}getImgs(){return function(t){let e=t.length;const i=[];for(let r=0;r<e;r++)i.push(t[r]);return i}(this.el.querySelectorAll(this.options.selector))}clear(){this.getImgs().forEach((t=>this.lazy.remove(t))),this.vnode=null,this.binding=null,this.lazy=null}}C.install=(t,e={})=>{const i=new($(t))(e),r=new C({lazy:i});"2"===t.version.split(".")[0]?t.directive("lazy-container",{bind:r.bind.bind(r),componentUpdated:r.update.bind(r),unbind:r.unbind.bind(r)}):t.directive("lazy-container",{update(t,e){r.update(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:t,oldValue:e},{context:this.vm})},unbind(){r.unbind(this.el)}})};const H=t=>({props:{src:[String,Object],tag:{type:String,default:"img"}},render(t){return t(this.tag,{attrs:{src:this.renderSrc}},this.$slots.default)},data:()=>({el:null,options:{src:"",error:"",loading:"",attempt:t.options.attempt},state:{loaded:!1,error:!1,attempt:0},rect:{},renderSrc:""}),watch:{src(){this.init(),t.addLazyBox(this),t.lazyLoadHandler()}},created(){this.init(),this.renderSrc=this.options.loading},mounted(){this.el=this.$el,t.addLazyBox(this),t.lazyLoadHandler()},beforeDestroy(){t.removeComponent(this)},methods:{init(){const{src:e,loading:i,error:r}=t._valueFormatter(this.src);this.state.loaded=!1,this.options.src=e,this.options.error=r,this.options.loading=i,this.renderSrc=this.options.loading},getRect(){this.rect=this.$el.getBoundingClientRect()},checkInView(){return this.getRect(),o&&this.rect.top<window.innerHeight*t.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*t.options.preLoad&&this.rect.right>0},load(e=L){if(this.state.attempt>this.options.attempt-1&&this.state.error)return t.options.silent||console.log(`VueLazyload log: ${this.options.src} tried too more than ${this.options.attempt} times`),void e();const i=this.options.src;v({src:i},(({src:t})=>{this.renderSrc=t,this.state.loaded=!0}),(t=>{this.state.attempt++,this.renderSrc=this.options.error,this.state.error=!0}))}}});H.install=(t,e={})=>{const i=new($(t))(e);t.component("lazy-image",H(i))};var V={install(t,e={}){const i=new($(t))(e),r=new T({lazy:i}),s="2"===t.version.split(".")[0];t.prototype.$Lazyload=i,e.lazyComponent&&t.component("lazy-component",O(i)),e.lazyImage&&t.component("lazy-image",H(i)),s?(t.directive("lazy",{bind:i.add.bind(i),update:i.update.bind(i),componentUpdated:i.lazyLoadHandler.bind(i),unbind:i.remove.bind(i)}),t.directive("lazy-container",{bind:r.bind.bind(r),componentUpdated:r.update.bind(r),unbind:r.unbind.bind(r)})):(t.directive("lazy",{bind:i.lazyLoadHandler.bind(i),update(t,e){n(this.vm.$refs,this.vm.$els),i.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:t,oldValue:e},{context:this.vm})},unbind(){i.remove(this.el)}}),t.directive("lazy-container",{update(t,e){r.update(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:t,oldValue:e},{context:this.vm})},unbind(){r.unbind(this.el)}}))}};t.Lazy=$,t.LazyComponent=O,t.LazyContainer=T,t.LazyImage=H,t.default=V,Object.defineProperty(t,"__esModule",{value:!0})}));
